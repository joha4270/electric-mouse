@model electric_mouse.Models.RouteViewModels.RouteCreateViewModel
<h2>Stuff</h2>
<form asp-controller="Route" asp-action="@(ViewBag.Update != null && ViewBag.Update == true ? "Update" : "Create")" method="post" class="col s12">
  <div class="row">
    <div class="input-field col s2">
      <input type="number" min="1" name="RouteID" value="@Model.RouteID" />
      <label for="id">Route ID</label>
    </div>
    <div class="input-field col s10">
      <select asp-for="RouteHallID" asp-items="@Model.Halls.Select(h => new SelectListItem {Text = h.Name, Value = h.RouteHallID.ToString() })" id="hallSelect">
        <option value="" disabled selected>Select a Hall</option>
      </select>
      <label>Hal</label>
    </div>
  </div>

  <div class="row">
    <div class="input-field col s6">
      <select name="RouteDifficultyID">
        @foreach (var difficulty in Model.Difficulties)
        {
            <option value="@difficulty.RouteDifficultyID">@difficulty.Name</option>
        }
      </select>
      <label>Difficulty</label>
    </div>
    <div class="input-field col s6">
      <select>
        <option value="1">Boulder</option>
      </select>
      <label>Route Type</label>
    </div>
  </div>

  <div class="row">
    <div class="input-field col s12">
      <select name="RouteSectionID" id="SectionSelect" multiple>
        <option value="" disabled selected>No Sections Found</option>
      </select>
      <label for="sections">Section</label>
    </div>
  </div>

  <div class="row">
    <div class="input-field col s12">
      <label for="date">Date</label>
      <input type="date" class="datepicker" name="Date" value="@Model.Date">
    </div>
  </div>

  <div class="row">
    <div class="input-field col s12">
      <input id="grip_color" type="text" name="GripColor" value="@Model.GripColor">
      <label for="grip_color">Grip Color</label>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <p>Image & Video row</p>
    </div>
  </div>

  <div class="row">
    <div class="input-field col s12">
      <textarea id="textarea1" class="materialize-textarea" name="Note">@Model.Note</textarea>
      <label for="textarea1">Note</label>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <button class="btn waves-effect waves-light red right" type="submit">
        Create Route
        <i class="material-icons right">send</i>
      </button>
    </div>
  </div>
</form>

@section scripts {

<script>
    var sections = {
        @foreach (var hall in Model.Halls)
        {
            @Html.Raw("'")@hall.RouteHallID@Html.Raw("': {")
             foreach (var s in Model.Sections.Where(i => i.RouteHallID == hall.RouteHallID))
             {
                 @Html.Raw("'")@s.RouteSectionID@Html.Raw("': '")@s.Name@Html.Raw("',")
             }
            @Html.Raw("},\n")
        }
    };

    $("#hallSelect").on('change', function() {
        var data = "";
        var parent = $(this).val();
        $.each(sections[parent], function(key, val) {
            data += '<option value="' + key + '">' + val + '</option>';
        });
        if(data == "") {data = '<option value="" disabled selected>No Sections Found</option>'}
        $("#SectionSelect").material_select("destroy");
        $("#SectionSelect").html(data);
        $("#SectionSelect").material_select();
    });
</script>
}